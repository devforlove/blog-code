
제가 운영하는 서비스에는 고질적으로 느린 쿼리가 있습니다. 평균 611.34ms의 실행시간을 보여주지만 문제는 특정 사람에게는 쿼리 실행시간이 유독 느리게 처리됩니다.  

![img.png](img.png)

문제가 되는 쿼리는 특정 유저가 이벤트를 진행했는지 여부를 체크하는 쿼리였습니다. 
대략적인 코드는 이렇습니다. 

```sql
SELECT
    COUNT(1)
FROM log_wheel
WHERE uid = 'ud-90fc0f29-ME-BHmO1pu0rs'
AND type= 'dw'
AND `status` = 'rv'
```

이상한 점은 어떤 유저는 쿼리 수행시간이 빠른 반면, 어떤 유저는 느려서 쿼리가 5초 이상 수행되기도 했습니다. 
그리고 공통적으로 count 결과값이 클수록 쿼리 수행 시간이 느렸습니다. 

count가 4개인 유저의 쿼리 수행시간입니다. 

![img_2.png](img_2.png)

반면, count가 2000개인 유저의 쿼리 수행시간입니다.

![img_1.png](img_1.png)

문제는 ```COUNT(1)```에 있었습니다. 



